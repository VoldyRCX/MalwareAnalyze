# coding:utf-8
# IDA批处理
# import sys
# 处理文件夹下文件

import os
import shutil
import subprocess
import config


def ida_processing_batch(in_path=config.path['malware_samplefolder'],
                         out_path=config.path['malware_sequencesfolder']):
    # 这里要清空输出目录
    for fpathe, dirs, fs in os.walk(in_path):
        for f in fs:
            filepath = (os.path.join(fpathe, f))

            tmpExecStr = config.path['ida64File'] + " -B -S" + config.path[
                'idapythonscript_se3'] + " " + filepath
            # print(tmpExecStr)
            subprocess.run(tmpExecStr, shell=True)
            # rename to save
            shutil.move(
                config.path['outfolder'] + config.filename['opcodetmp'],
                out_path + f + '.txt')
            o1, o2 = os.path.splitext(filepath)
            os.remove(o1 + '.i64')
    print("All Process have been done")


if __name__ == '__main__':
    ida_processing_batch()


class Idabatch():
    def __init__(self):
        pass
